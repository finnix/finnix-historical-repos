#!/bin/sh
set -e

#DEBHELPER#

if [ "$1" = configure ] && [ -z "$2" ]; then
  for fn in /sbin/init /sbin/telinit; do
    if ! [ -e "$fn.distrib" ]; then
      dpkg-divert --rename --package finnix-scripts --divert "$fn.distrib" --add "$fn"
      ln -s "$(basename $fn).finnix" "$fn"
    fi
  done

  # /etc/init.d/ssh must be handled specially
  if ! [ -e "/lib/finnix/init.d/ssh.distrib" ]; then
    dpkg-divert --rename --package finnix-scripts --divert "/lib/finnix/init.d/ssh.distrib" --add "/etc/init.d/ssh"
    ln -s "/lib/finnix/init.d/ssh.finnix" "/etc/init.d/ssh"
  fi

  if ! grep /etc/bash.bashrc.finnix /etc/bash.bashrc >/dev/null 2>/dev/null; then
    echo '[ -r /etc/bash.bashrc.finnix ] && . /etc/bash.bashrc.finnix' >>/etc/bash.bashrc
  fi

  if ! getent passwd finnix >/dev/null 2>/dev/null; then
    useradd --create-home --shell /bin/bash finnix
  fi
fi
